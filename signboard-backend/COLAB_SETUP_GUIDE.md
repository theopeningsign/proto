# 📚 Colab Pix2Pix 학습 가이드

이 가이드는 Google Colab을 사용하여 간판 Pix2Pix 모델을 학습하는 전체 과정을 설명합니다.

---

## 📋 목차

1. [사전 준비](#1-사전-준비)
2. [Google Drive API 설정](#2-google-drive-api-설정)
3. [데이터 업로드](#3-데이터-업로드)
4. [Colab 노트북 사용](#4-colab-노트북-사용)
5. [문제 해결](#5-문제-해결)

---

## 1. 사전 준비

### 필요 사항

- ✅ Google 계정
- ✅ Google Drive 계정
- ✅ Windows/Mac/Linux 컴퓨터
- ✅ Python 3.8 이상
- ✅ 인터넷 연결

### 프로젝트 구조 확인

```
signboard-backend/
├── phase2_data/
│   └── paired_data/          # 학습 데이터 (110개 파일)
│       ├── train/
│       │   ├── input/        # CG 간판 이미지
│       │   └── target/       # 실제 사진
│       └── test/
│           ├── input/
│           └── target/
├── upload_to_drive.py        # 업로드 스크립트
├── setup_and_upload.ps1      # 설정 스크립트 (Windows)
├── credentials.json.template # 템플릿 파일
└── pix2pix_training.ipynb    # Colab 노트북
```

---

## 2. Google Drive API 설정

### 2-1. Google Cloud Console 접속

1. 브라우저에서 다음 주소로 이동:
   ```
   https://console.cloud.google.com/
   ```

2. Google 계정으로 로그인

### 2-2. 프로젝트 생성

1. 상단 메뉴에서 **"프로젝트 선택"** 클릭
2. **"새 프로젝트"** 클릭
3. 프로젝트 이름 입력 (예: `signboard-pix2pix`)
4. **"만들기"** 클릭
5. 프로젝트가 생성되면 선택

### 2-3. Google Drive API 활성화

1. 왼쪽 메뉴에서 **"API 및 서비스"** → **"라이브러리"** 클릭
2. 검색창에 `Google Drive API` 입력
3. **"Google Drive API"** 선택
4. **"사용 설정"** 클릭

### 2-4. OAuth 2.0 클라이언트 ID 생성

1. 왼쪽 메뉴에서 **"API 및 서비스"** → **"사용자 인증 정보"** 클릭
2. 상단 **"+ 사용자 인증 정보 만들기"** 클릭
3. **"OAuth 클라이언트 ID"** 선택
4. 처음이면 **"동의 화면 구성"** 진행:
   - 사용자 유형: **"외부"** 선택
   - 앱 이름: `Signboard Data Uploader` (임의)
   - 사용자 지원 이메일: 본인 이메일
   - 개발자 연락처 정보: 본인 이메일
   - **"저장 후 계속"** 클릭
   - 스코프: 기본값 그대로 **"저장 후 계속"**
   - **⚠️ 중요: 테스트 사용자에 본인 이메일 추가**
     - **"+ 사용자 추가"** 클릭
     - 본인 이메일 주소 입력 (예: `hyukjune.gp@gmail.com`)
     - **"추가"** 클릭
     - **"저장 후 계속"** 클릭
   - 요약 확인 → **"대시보드로 돌아가기"**
   
   **⚠️ 만약 이미 동의 화면을 만들었다면:**
   - **"API 및 서비스"** → **"OAuth 동의 화면"** 클릭
   - **"테스트 사용자"** 섹션에서 **"+ 사용자 추가"** 클릭
   - 본인 이메일 추가
   - **"저장"** 클릭

5. 다시 **"사용자 인증 정보"** → **"+ 사용자 인증 정보 만들기"** → **"OAuth 클라이언트 ID"**
6. 애플리케이션 유형: **"데스크톱 앱"** 선택
7. 이름: `Signboard Uploader` (임의)
8. **"만들기"** 클릭

### 2-5. credentials.json 다운로드

1. 생성된 OAuth 클라이언트 ID 옆의 **⬇️ 다운로드 아이콘** 클릭
2. 다운로드된 JSON 파일을 `credentials.json`으로 이름 변경
3. `signboard-backend` 폴더에 저장:
   ```
   signboard-backend/
   └── credentials.json  ← 여기에 저장
   ```

✅ **이제 credentials.json 준비 완료!**

---

## 3. 데이터 업로드

### 3-1. Windows에서 업로드

1. PowerShell 또는 명령 프롬프트 열기
2. `signboard-backend` 폴더로 이동:
   ```powershell
   cd D:\cursor\proto\signboard-backend
   ```
3. 설정 및 업로드 스크립트 실행:
   ```powershell
   .\setup_and_upload.ps1
   ```

### 3-2. 업로드 과정

**최초 실행 시:**

1. 필요한 라이브러리 자동 설치 (1-2분)
2. `credentials.json` 확인
3. 웹 브라우저가 자동으로 열림
4. Google 계정으로 로그인
5. **"이 앱이 Google Drive에 액세스하는 것을 허용하시겠습니까?"** → **"허용"** 클릭
6. 자동으로 파일 업로드 시작 (2-5분)
7. 완료 메시지 확인

**이후 실행 시:**

- 저장된 토큰(`token.json`)으로 자동 업로드
- 로그인 불필요

### 3-3. 업로드 확인

1. Google Drive 웹사이트 접속: https://drive.google.com
2. `Colab_Signboard_Data` 폴더 확인
3. 폴더 구조 확인:
   ```
   Colab_Signboard_Data/
   ├── train/
   │   ├── input/    (약 40개 파일)
   │   └── target/   (약 40개 파일)
   └── test/
       ├── input/    (약 15개 파일)
       └── target/   (약 15개 파일)
   ```

---

## 4. Colab 노트북 사용

### 4-1. 노트북 열기

1. Google Colab 접속: https://colab.research.google.com
2. **"파일"** → **"노트북 업로드"** 클릭
3. `pix2pix_training.ipynb` 파일 선택
4. 또는 다음 방법:
   - GitHub/GitLab에 업로드 후 Colab에서 열기
   - Google Drive에 업로드 후 Colab에서 열기

### 4-2. GPU 런타임 설정

1. 상단 메뉴: **"런타임"** → **"런타임 유형 변경"**
2. 하드웨어 가속기: **"GPU"** 선택
3. **"저장"** 클릭

### 4-3. 노트북 실행

1. 각 셀을 순서대로 실행 (▶️ 버튼 클릭)
2. 또는 **"런타임"** → **"모두 실행"** 클릭

**섹션별 설명:**

- **섹션 1**: GPU 확인
- **섹션 2**: Google Drive 연결 (인증 필요)
- **섹션 3**: Pix2Pix 설치
- **섹션 4**: 데이터 준비
- **섹션 5**: 데이터 샘플 확인
- **섹션 6**: 학습 시작 (2-4시간 소요)
- **섹션 7**: 중간 결과 확인 (학습 중간에 실행 가능)
- **섹션 8**: 테스트 실행 (학습 완료 후)
- **섹션 9**: 테스트 결과 확인
- **섹션 10**: 모델 다운로드 (선택사항)

### 4-4. 학습 모니터링

**학습 중:**

- 터미널 출력에서 Loss 값 확인:
  ```
  Epoch [1/200]
    G_GAN: 2.451, G_L1: 45.234, D_real: 0.823, D_fake: 0.291
  ```

**중간 결과 확인:**

- 학습이 진행되면 섹션 7을 실행하여 생성된 이미지 확인
- 경로: `checkpoints/signboard_pix2pix_v1/web/images/epochXXX/`
  - `real_A.png`: INPUT (CG 이미지)
  - `fake_B.png`: OUTPUT (모델이 생성한 이미지)
  - `real_B.png`: TARGET (실제 사진)

---

## 5. 문제 해결

### ❌ 문제: credentials.json을 찾을 수 없음

**해결:**
1. 파일 이름이 정확히 `credentials.json`인지 확인
2. `signboard-backend` 폴더에 있는지 확인
3. Google Cloud Console에서 다시 다운로드

---

### ❌ 문제: "인증 오류" 또는 "액세스 거부됨"

**해결:**
1. Google Cloud Console에서 OAuth 동의 화면 확인
2. 테스트 사용자에 본인 이메일이 추가되어 있는지 확인
3. `token.json` 파일 삭제 후 다시 인증:
   ```powershell
   Remove-Item token.json
   .\setup_and_upload.ps1
   ```

---

### ❌ 문제: 업로드가 너무 느림

**원인:**
- 네트워크 속도
- 파일 크기 (총 약 50-100MB 예상)

**해결:**
- 시간이 오래 걸릴 수 있으니 기다리기
- 네트워크 연결 확인
- 파일 개수 확인 (약 110개)

---

### ❌ 문제: Colab에서 GPU가 감지되지 않음

**해결:**
1. **"런타임"** → **"런타임 유형 변경"** → **"GPU"** 선택
2. 런타임 재시작: **"런타임"** → **"런타임 다시 시작"**
3. Colab 무료 GPU 할당량 확인 (일일 제한 있음)

---

### ❌ 문제: "데이터 경로를 찾을 수 없음"

**해결:**
1. Google Drive에 `Colab_Signboard_Data` 폴더가 있는지 확인
2. 폴더 이름이 정확한지 확인 (대소문자 구분)
3. 업로드 스크립트가 정상적으로 실행되었는지 확인

---

### ❌ 문제: 학습이 너무 느림

**원인:**
- GPU가 아닌 CPU 사용
- 배치 크기가 너무 큼

**해결:**
1. GPU 런타임 사용 확인
2. 배치 크기를 1로 설정 (이미 설정됨)
3. 데이터 개수가 적어도 느릴 수 있음 (정상)

---

### ❌ 문제: 학습 중 오류 발생

**확인 사항:**
1. 데이터 파일이 손상되지 않았는지
2. 이미지 형식이 올바른지 (PNG/JPG)
3. Colab 런타임이 종료되지 않았는지

**해결:**
- 오류 메시지 확인
- 해당 섹션을 다시 실행
- 런타임 재시작 후 처음부터 다시 실행

---

## 📊 예상 소요 시간

| 단계 | 소요 시간 |
|------|----------|
| Google Drive API 설정 | 10-15분 |
| 데이터 업로드 (최초) | 5-10분 |
| Colab 노트북 설정 | 5-10분 |
| 학습 (GPU) | 2-4시간 |
| 테스트 | 5-10분 |

**총 예상 시간: 약 3-5시간** (초기 설정 포함)

---

## 🎯 다음 단계

학습이 완료되면:

1. ✅ 테스트 결과 확인
2. ✅ 모델 다운로드 (선택사항)
3. ✅ 실제 애플리케이션에 통합
4. ✅ 추가 데이터로 재학습 (품질 향상)

---

## 📞 추가 도움

문제가 계속되면:

1. 오류 메시지 전체 복사
2. 실행한 명령어 확인
3. 로그 파일 확인 (`token.json` 등)

---

**행운을 빕니다! 🚀**

